<!-- Modal -->
<div class="modal fade" id="ModalLong" tabindex="-1" role="dialog" aria-labelledby="ModalLongTitle" aria-hidden="true">
    <div class="modal-dialog modal-xl" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="ModalLongTitle">
            <i class="nav-icon fas fa-user"></i>
            Unidad Medidas/Lista Precios </h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">
<!--  -->

<div class="card">

  <div class="card-body">
        
        
        <form id="formPrecio"  method="PUT" action="" enctype="multipart/form-data">

        <div class="row float-right">
          <div class="col-sm-4">


            <div class="form-group col-md-12">
                   Unidad de Medida Principal
            </div>
            <input type="text" id="lista0" hidden>  

            <div class="form-row">
              <div class="form-group col-md-6">
                <select class="form-control" id="select-unidades0">

                </select>
              </div>
              <div class="form-group col-md-6"></div>
            </div>


            <div class="form-group col-md-9">
              <div class="input-group mb-3">
                  <div class="input-group-prepend">
                      <span class="input-group-text">1.</span>
                  </div> 
                  <input type="text" id="precio00" class="form-control input-numero-decimal2 lista0" placeholder="Precio 1">  
                  <div class="input-group-append">
                    <span class="input-group-text">$</span>
                  </div>
              </div> 
          </div>

            <div class="form-group col-md-9">
              <div class="input-group mb-3">
                  <div class="input-group-prepend">
                      <span class="input-group-text">2.</span>
                  </div> 
                  <input type="text" id="precio01" class="form-control input-numero-decimal2 lista0" placeholder="Precio 2">  
                  <div class="input-group-append">
                    <span class="input-group-text">$</span>
                  </div>
              </div> 
          </div>

            <div class="form-group col-md-9">
              <div class="input-group mb-3">
                  <div class="input-group-prepend">
                      <span class="input-group-text">3.</span>
                  </div> 
                  <input type="text" id="precio02" class="form-control input-numero-decimal2 lista0" placeholder="Precio 3">  
                  <div class="input-group-append">
                    <span class="input-group-text">$</span>
                  </div>
              </div> 
          </div> 

          <div class="form-group col-md-9">
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text">4.</span>
                </div> 
                <input type="text" id="precio03" class="form-control input-numero-decimal2 lista0" placeholder="Precio 4">  
                <div class="input-group-append">
                  <span class="input-group-text">$</span>
                </div>
            </div> 
        </div>

        <div class="form-group col-md-9">
          <div class="input-group mb-3">
              <div class="input-group-prepend">
                  <span class="input-group-text">5.</span>
              </div> 
              <input type="text" id="precio04" class="form-control input-numero-decimal2 lista0" placeholder="Precio 5">  
              <div class="input-group-append">
                <span class="input-group-text">$</span>
              </div>
          </div> 
      </div>

      <div class="form-group col-md-9">
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text">6.</span>
            </div> 
            <input type="text" id="precio05" class="form-control input-numero-decimal2 lista0" placeholder="Precio 6">  
            <div class="input-group-append">
              <span class="input-group-text">$</span>
            </div>
        </div> 
    </div>

    <div class="form-group col-md-9">
      <div class="input-group mb-3">
          <div class="input-group-prepend">
              <span class="input-group-text">7.</span>
          </div> 
          <input type="text" id="precio06" class="form-control input-numero-decimal2 lista0" placeholder="Precio 7">  
          <div class="input-group-append">
            <span class="input-group-text">$</span>
          </div>
      </div> 
  </div>

  <div class="form-group col-md-9">
    <div class="input-group mb-3">
        <div class="input-group-prepend">
            <span class="input-group-text">8.</span>
        </div> 
        <input type="text" id="precio07" class="form-control input-numero-decimal2 lista0" placeholder="Precio 8">  
        <div class="input-group-append">
          <span class="input-group-text">$</span>
        </div>
    </div> 
</div>

<div class="form-group col-md-9">
  <div class="input-group mb-3">
      <div class="input-group-prepend">
          <span class="input-group-text">9.</span>
      </div> 
      <input type="text" id="precio08" class="form-control input-numero-decimal2 lista0" placeholder="Precio 9">  
      <div class="input-group-append">
        <span class="input-group-text">$</span>
      </div>
  </div> 
</div>

<div class="form-group col-md-9">
  <label> Precio E-commerce </label>
  <div class="input-group mb-3">
      <input type="text" id="ecommerceprecio" class="form-control input-numero-decimal2 lista0" placeholder="E-commerce">  
      <div class="input-group-append">
        <span class="input-group-text">$</span>
      </div>
  </div> 
</div>

          </div>
          <div class="col-sm-4">


            <div class="form-row">
              <div class="form-group col-md-9">
              UND Alterna 1/Factor Conversion gr
            </div>

            <div id="div1" class="form-group col-md-3" style="display: none;" >
              <button class="btn btn-success btn-sm" type="button"  id="crear1">
                <i class="fas fa fa-plus" aria-hidden="true"></i>
              </button>
            </div>

            <input type="text" id="lista1" hidden>  

            
              <div class="form-group col-md-5">
                <select class="form-control lista1" id="select-unidades1">

                </select>
              </div>
              
              <div class="form-group col-md-5">
                <div class="input-group mb-3">
                    <input type="text" id="factorconversion1" class="form-control input-numero-decimal2 lista1" placeholder="Factor Conversion">  
                    <div class="input-group-append">
                      <span class="input-group-text">gr</span>
                    </div>
                  </div>
              </div>
            </div>

            <div class="form-group col-md-9">
              <div class="input-group mb-3">
                  <div class="input-group-prepend">
                      <span class="input-group-text">1.</span>
                  </div> 
                  <input type="text" id="precio10" class="form-control input-numero-decimal2 lista1" placeholder="Precio 1">  
                  <div class="input-group-append">
                    <span class="input-group-text">$</span>
                  </div>
              </div> 
          </div>

            <div class="form-group col-md-9">
              <div class="input-group mb-3">
                  <div class="input-group-prepend">
                      <span class="input-group-text">2.</span>
                  </div> 
                  <input type="text" id="precio11" class="form-control input-numero-decimal2 lista1" placeholder="Precio 2">  
                  <div class="input-group-append">
                    <span class="input-group-text">$</span>
                  </div>
              </div> 
          </div>

            <div class="form-group col-md-9">
              <div class="input-group mb-3">
                  <div class="input-group-prepend">
                      <span class="input-group-text">3.</span>
                  </div> 
                  <input type="text" id="precio12" class="form-control input-numero-decimal2 lista1" placeholder="Precio 3">  
                  <div class="input-group-append">
                    <span class="input-group-text">$</span>
                  </div>
              </div> 
          </div> 

          <div class="form-group col-md-9">
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text">4.</span>
                </div> 
                <input type="text" id="precio13" class="form-control input-numero-decimal2 lista1" placeholder="Precio 4">  
                <div class="input-group-append">
                  <span class="input-group-text">$</span>
                </div>
            </div> 
        </div>

        <div class="form-group col-md-9">
          <div class="input-group mb-3">
              <div class="input-group-prepend">
                  <span class="input-group-text">5.</span>
              </div> 
              <input type="text" id="precio14" class="form-control input-numero-decimal2 lista1" placeholder="Precio 5">  
              <div class="input-group-append">
                <span class="input-group-text">$</span>
              </div>
          </div> 
      </div>

      <div class="form-group col-md-9">
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text">6.</span>
            </div> 
            <input type="text" id="precio15" class="form-control input-numero-decimal2 lista1" placeholder="Precio 6">  
            <div class="input-group-append">
              <span class="input-group-text">$</span>
            </div>
        </div> 
    </div>

    <div class="form-group col-md-9">
      <div class="input-group mb-3">
          <div class="input-group-prepend">
              <span class="input-group-text">7.</span>
          </div> 
          <input type="text" id="precio16" class="form-control input-numero-decimal2 lista1" placeholder="Precio 7">  
          <div class="input-group-append">
            <span class="input-group-text">$</span>
          </div>
      </div> 
  </div>

  <div class="form-group col-md-9">
    <div class="input-group mb-3">
        <div class="input-group-prepend">
            <span class="input-group-text">8.</span>
        </div> 
        <input type="text" id="precio17" class="form-control input-numero-decimal2 lista1" placeholder="Precio 8">  
        <div class="input-group-append">
          <span class="input-group-text">$</span>
        </div>
    </div> 
</div>

<div class="form-group col-md-9">
  <div class="input-group mb-3">
      <div class="input-group-prepend">
          <span class="input-group-text">9.</span>
      </div> 
      <input type="text" id="precio18" class="form-control input-numero-decimal2 lista1" placeholder="Precio 9">  
      <div class="input-group-append">
        <span class="input-group-text">$</span>
      </div>
  </div> 
</div>

<div class="form-group col-md-9">
  <div class="input-group mb-3">
    <div class="input-group-prepend">
      <span class="input-group-text">10.</span>
  </div> 
      <input type="text" id="precio19" class="form-control input-numero-decimal2 lista1" placeholder="Precio 10">  
      <div class="input-group-append">
        <span class="input-group-text">$</span>
      </div>
  </div> 
</div>
            
          </div>
          <div class="col-sm-4">


            <div class="form-row">
              <div class="form-group col-md-9">
              UND Alterna 2/Factor Conversion gr
            </div>

            <div id="div2" class="form-group col-md-3" style="display: none;" >
              <button class="btn btn-success btn-sm" type="button" id="crear2">
                <i class="fas fa fa-plus" aria-hidden="true"></i>
              </button>
            </div>

            <input type="text" id="lista2" hidden>  




              <div class="form-group col-md-5">
                <select class="form-control lista2" id="select-unidades2">

                </select>
              </div>
              
              <div class="form-group col-md-5">
                <div class="input-group mb-3">
                    <input type="text" id="factorconversion2" class="form-control input-numero-decimal2 lista2" placeholder="Factor Conversion">  
                    <div class="input-group-append">
                      <span class="input-group-text">gr</span>
                    </div>
                  </div>
              </div>
            </div>


            <div class="form-group col-md-9">
              <div class="input-group mb-3">
                  <div class="input-group-prepend">
                      <span class="input-group-text">1.</span>
                  </div> 
                  <input type="text" id="precio20" class="form-control input-numero-decimal2 lista2" placeholder="Precio 1">  
                  <div class="input-group-append">
                    <span class="input-group-text">$</span>
                  </div>
              </div> 
          </div>

            <div class="form-group col-md-9">
              <div class="input-group mb-3">
                  <div class="input-group-prepend">
                      <span class="input-group-text">2.</span>
                  </div> 
                  <input type="text" id="precio21" class="form-control input-numero-decimal2 lista2" placeholder="Precio 2">  
                  <div class="input-group-append">
                    <span class="input-group-text">$</span>
                  </div>
              </div> 
          </div>

            <div class="form-group col-md-9">
              <div class="input-group mb-3">
                  <div class="input-group-prepend">
                      <span class="input-group-text">3.</span>
                  </div> 
                  <input type="text" id="precio22" class="form-control input-numero-decimal2 lista2" placeholder="Precio 3">  
                  <div class="input-group-append">
                    <span class="input-group-text">$</span>
                  </div>
              </div> 
          </div> 

          <div class="form-group col-md-9">
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text">4.</span>
                </div> 
                <input type="text" id="precio23" class="form-control input-numero-decimal2 lista2" placeholder="Precio 4">  
                <div class="input-group-append">
                  <span class="input-group-text">$</span>
                </div>
            </div> 
        </div>

        <div class="form-group col-md-9">
          <div class="input-group mb-3">
              <div class="input-group-prepend">
                  <span class="input-group-text">5.</span>
              </div> 
              <input type="text" id="precio24" class="form-control input-numero-decimal2 lista2" placeholder="Precio 5">  
              <div class="input-group-append">
                <span class="input-group-text">$</span>
              </div>
          </div> 
      </div>

      <div class="form-group col-md-9">
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text">6.</span>
            </div> 
            <input type="text" id="precio25" class="form-control input-numero-decimal2 lista2" placeholder="Precio 6">  
            <div class="input-group-append">
              <span class="input-group-text">$</span>
            </div>
        </div> 
    </div>

    <div class="form-group col-md-9">
      <div class="input-group mb-3">
          <div class="input-group-prepend">
              <span class="input-group-text">7.</span>
          </div> 
          <input type="text" id="precio26" class="form-control input-numero-decimal2 lista2" placeholder="Precio 7">  
          <div class="input-group-append">
            <span class="input-group-text">$</span>
          </div>
      </div> 
  </div>

<div class="form-group col-md-9">
  <div class="input-group mb-3">
      <div class="input-group-prepend">
          <span class="input-group-text">8.</span>
      </div> 
      <input type="text" id="precio27" class="form-control input-numero-decimal2 lista2" placeholder="Precio 8">  
      <div class="input-group-append">
        <span class="input-group-text">$</span>
      </div>
  </div> 
</div>

<div class="form-group col-md-9">
  <div class="input-group mb-3">
      <div class="input-group-prepend">
          <span class="input-group-text">9.</span>
      </div> 
      <input type="text" id="precio28" class="form-control input-numero-decimal2 lista2" placeholder="Precio 9">  
      <div class="input-group-append">
        <span class="input-group-text">$</span>
      </div>
  </div> 
</div>

<div class="form-group col-md-9">
  <div class="input-group mb-3">
    <div class="input-group-prepend">
      <span class="input-group-text">10.</span>
  </div> 
      <input type="text" id="precio29" class="form-control input-numero-decimal2 lista2" placeholder="Precio 10">  
      <div class="input-group-append">
        <span class="input-group-text">$</span>
      </div>
  </div> 
</div>

          </div>
        </div>


            <div class="col-12 float-right">
                <button type="submit" class="btn btn-primary">Actualizar</button>
                <button type="button" class="btn btn-secondary float-right" data-dismiss="modal">Cerrar</button>
            </div> 

        </form>

    </div>

</div>
</div>




<!--  -->
        </div>
        <div class="modal-footer">
          <input type="text" id="costounitario" hidden>  

        </div>
      </div>
    </div>

<script>


$("#formPrecio").submit(function(e) {
e.preventDefault(); 

  if($('#lista0').val()){
    enviaLista(0);
  }

  if($('#lista1').val()){
    enviaLista(1);
  }

  if($('#lista2').val()){
    enviaLista(2);
  }

});



function enviaLista(k){
  var lista = $('#lista'+k).val() ? $('#lista'+k).val() : null;

  if(lista){

    const form = document.getElementById('formPrecio');
    const formData = new FormData(form);

    var ecommerceprecio = $('#ecommerceprecio').val()? $('#ecommerceprecio').val() : '';
    var factorconversion = $('#factorconversion' + k).val()? $('#factorconversion' + k).val() : '';
    var unidadesmedida_id = $('#select-unidades' + k).val()? $('#select-unidades' + k).val() : '';

    var precio0 = $('#precio' +k+0).val()? $('#precio' +k+0).val() : '';
    var precio1 = $('#precio' +k+1).val()? $('#precio' +k+1).val() : '';
    var precio2 = $('#precio' +k+2).val()? $('#precio' +k+2).val() : '';
    var precio3 = $('#precio' +k+3).val()? $('#precio' +k+3).val() : '';
    var precio4 = $('#precio' +k+4).val()? $('#precio' +k+4).val() : '';
    var precio5 = $('#precio' +k+5).val()? $('#precio' +k+5).val() : '';
    var precio6 = $('#precio' +k+6).val()? $('#precio' +k+6).val() : '';
    var precio7 = $('#precio' +k+7).val()? $('#precio' +k+7).val() : '';
    var precio8 = $('#precio' +k+8).val()? $('#precio' +k+8).val() : '';
    var precio9 = $('#precio' +k+9).val()? $('#precio' +k+9).val() : '';

    formData.append("precio0", precio0);
    formData.append("precio1", precio1);
    formData.append("precio2", precio2);
    formData.append("precio3", precio3);
    formData.append("precio4", precio4);
    formData.append("precio5", precio5);
    formData.append("precio6", precio6);
    formData.append("precio7", precio7);
    formData.append("precio8", precio8);
    formData.append("precio9", precio9);
    formData.append("factorconversion", factorconversion);
    formData.append("ecommerceprecio", ecommerceprecio);
    formData.append("unidadesmedida_id", unidadesmedida_id);
    formData.append('_method', 'PUT');

         $.ajax({
          method: "POST",
          url: url_back + "unidadesmedidalistaprecios/"+lista,
          headers: { 
              Authorization: 'Bearer ' + localStorage.access_token
          },
          dataType: "json",
          data: formData,
          contentType: false,//formData
          processData: false,//formData
          success: function(respuesta) {

                  var mensaje = 'Lista Precio Asociadas actualizado de forma correcta.: ';
                  sweetMessage('success', mensaje); 
                  regresa(true);
          },
          error: function(respuesta) {

              if(respuesta.responseJSON.error){
                  $.each(respuesta.responseJSON.error.message, function (key, item) {
                      var mensaje = item[0];
                      sweetMessage('error', mensaje);
                  });
              }else{
                  var mensaje = 'Se presentó un error. Por favor, inténtelo mas tarde.';
                  sweetMessage('error', mensaje);
              }
              
          }
      });
    }

    function regresa(bool) {
          if(bool){
            $('#ModalLong').modal('hide');
            $('ModalLong').removeClass('show');
            $('.modal-backdrop').remove();
          }
    };
  }


var crearLista = function(e){
e.preventDefault(); 

  const form = document.getElementById('formPrecio');
  const formData = new FormData(form);

  var articulo_id = localStorage.editar;
  var creador_id = localStorage.id;

  formData.append("articulo_id", articulo_id);
  formData.append("creador_id", creador_id);

  if('crear2'== e.target.id){
    var lista = '#lista2';
    $('#div2').hide();
    $(".lista2").prop('disabled', false);

  }else if('crear1'== e.target.id){
    var lista = '#lista1';
    $('#div1').hide();
    $(".lista1").prop('disabled', false);

  }
  
  $.ajax({
          method: "POST",
          url: url_back + "unidadesmedidalistaprecios",
          headers: { 
              Authorization: 'Bearer ' + localStorage.access_token
          },
          dataType: "json",
          data: formData,
          contentType: false,//formData
          processData: false,//formData
          success: function(respuesta) {

                  var mensaje = 'Lista Precio Asociadas creado de forma correcta.: ';
                  sweetMessage('success', mensaje); 
                  obtenerListaprecio(localStorage.editar);
                  $('#div1').hide();
                  $('#div2').hide();
          },
          error: function(respuesta) {

              if(respuesta.responseJSON.error){
                  $.each(respuesta.responseJSON.error.message, function (key, item) {
                      var mensaje = item[0];
                      sweetMessage('error', mensaje);
                  });

              }else{
                  var mensaje = 'Se presentó un error. Por favor, inténtelo mas tarde.';
                  sweetMessage('error', mensaje);

              }
          }
      });

}

function validarCostounitario(e){

  if(parseInt($(this).val()) < parseInt($('#costounitario').val()) && e.target.id != 'factorconversion2' && e.target.id != 'factorconversion1' && e.target.id != 'select-unidades1' && e.target.id != 'select-unidades2'){
        var mensaje = 'el precio debe ser mayor al Costo Unitario.: ' + $('#costounitario').val();
        sweetMessage('info', mensaje);
        $(this).val('');
  }
}


function obtenerListaprecio(id){
var url = 'articulos/'+ id;

$.ajax({
    method: "GET",
    url: url_back + url,
    headers: { 
                  Authorization: 'Bearer ' + localStorage.access_token
              },
    dataType: "json",
    success: function(respuesta) {

      $('#costounitario').val(respuesta.data.costounitario);
      arre = respuesta.data.unidadesmedidalistaprecio;

      ordenarPrecio(arre);

      if(arre.length == 1){
            $('#div1').show();
            $(".lista1").prop('disabled', true);
            $('#div2').show();
            $(".lista2").prop('disabled', true);
      }else if(arre.length == 2){
          $('#div2').show();
          $(".lista1").prop('disabled', false);
          $(".lista2").prop('disabled', true);
      }else if(arre.length == 3){
          $(".lista1").prop('disabled', false);
          $(".lista2").prop('disabled', false);
      }

    },
    error: function() {
        var mensaje = 'Se presentó un error. Por favor, inténtelo mas tarde.';
        sweetMessage('error', mensaje);
    }
  })  
}


function ordenarPrecio(arre){
  var  k= 0;

arre.forEach(function callback(element, i) {

  element.id ? $('#lista' + k).val(element.id): '';

  element.precio0 ? $('#precio'+ k + 0).val(element.precio0): '';
  element.precio1 ? $('#precio'+ k + 1).val(element.precio1): '';
  element.precio2 ? $('#precio'+ k + 2).val(element.precio2): '';
  element.precio3 ? $('#precio'+ k + 3).val(element.precio3): '';
  element.precio4 ? $('#precio'+ k + 4).val(element.precio4): '';
  element.precio5 ? $('#precio'+ k + 5).val(element.precio5): '';
  element.precio6 ? $('#precio'+ k + 6).val(element.precio6): '';
  element.precio7 ? $('#precio'+ k + 7).val(element.precio7): '';
  element.precio8 ? $('#precio'+ k + 8).val(element.precio8): '';
  element.precio9 ? $('#precio'+ k + 9).val(element.precio9): '';
  
        if(element.ecommerceprecio){
          $('#ecommerceprecio').val(element.ecommerceprecio);
        }

        if(element.factorconversion){
          $('#factorconversion'+i).val(element.factorconversion);
        }

        if(element.unidadesmedida_id){
        obtenerSelect('unidadesmedidas','#select-unidades'+i, element.unidadesmedida_id );
         }else{
        obtenerSelects('unidadesmedidas','#select-unidades'+i);
        }

        k++;
      });
      

    }


$( document ).ready(function() {
    $('.preloader').hide("slow");
      validarLogin();
      obtenerListaprecio(localStorage.editar);

      $("#crear1").on("click",crearLista);
      $("#crear2").on("click",crearLista);

      $('.lista0').on("blur",validarCostounitario);
      $('.lista1').on("blur",validarCostounitario);
      $('.lista2').on("blur",validarCostounitario);
});

</script>

<!-- validaciones -->
<script src="../../build/js/validaciones.js"></script>