<!-- Modal -->
<div class="modal fade" id="ModalLong4" tabindex="-1" role="dialog" aria-labelledby="ModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="ModalLongTitle">
            <i class="nav-icon fas fa-user"></i>
            Editar Articulo Equivalente </h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">
<!--  -->

<div class="card">

  <div class="card-body">
        
        
        <form id="formEquivalente"  method="PUT" action="" enctype="multipart/form-data">

          
          <div class="row">

            <div class="form-group col-md-10">
                <label for="artículoequivalente0">Articulo Equivalente 1 </label>
                <input class="form-control input-texto-alfanumerico" id="artículoequivalente0" placeholder="Nombre Articulo" > 
              </div>
                
                <div id="div0" class="form-group col-md-2" style="display: none;">
                  <button class="btn btn-danger btn-sm" style="margin-top:50% ;" type="button" onclick="eliminarEquivalente('#artículoequivalente0')">
                    <i class="fas fa-trash" aria-hidden="true"></i>
                  </button>
                </div>
          </div>
                <input class="form-control input-texto-alfanumerico" id="artículoequivalente0_id" hidden>


                <div class="row">

                  <div class="form-group col-md-10">
                      <label for="artículoequivalente1">Articulo Equivalente 2 </label>
                      <input class="form-control input-texto-alfanumerico" id="artículoequivalente1" placeholder="Nombre Articulo" > 
                    </div>
                      
                      <div id="div1" class="form-group col-md-2" style="display: none;">
                        <button class="btn btn-danger btn-sm" style="margin-top:50% ;" type="button" onclick="eliminarEquivalente('#artículoequivalente1')">
                          <i class="fas fa-trash" aria-hidden="true"></i>
                        </button>
                      </div>
                </div>
                      <input class="form-control input-texto-alfanumerico" id="artículoequivalente1_id" hidden>

               
                  <div class="row">

                    <div class="form-group col-md-10">
                        <label for="artículoequivalente2">Articulo Equivalente 3 </label>
                        <input class="form-control input-texto-alfanumerico" id="artículoequivalente2" placeholder="Nombre Articulo" > 
                      </div>
                        
                        <div id="div2" class="form-group col-md-2" style="display: none;">
                          <button class="btn btn-danger btn-sm" style="margin-top:50% ;" type="button" onclick="eliminarEquivalente('#artículoequivalente2')">
                            <i class="fas fa-trash" aria-hidden="true"></i>
                          </button>
                        </div>
                  </div>
                        <input class="form-control input-texto-alfanumerico" id="artículoequivalente2_id" hidden>


                    <div class="row">

                      <div class="form-group col-md-10">
                          <label for="artículoequivalente3">Articulo Equivalente 4 </label>
                          <input class="form-control input-texto-alfanumerico" id="artículoequivalente3" placeholder="Nombre Articulo" > 
                        </div>
                          
                          <div id="div3" class="form-group col-md-2" style="display: none;">
                            <button class="btn btn-danger btn-sm" style="margin-top:50% ;" type="button" onclick="eliminarEquivalente('#artículoequivalente3')">
                              <i class="fas fa-trash" aria-hidden="true"></i>
                            </button>
                          </div>
                    </div>
                          <input class="form-control input-texto-alfanumerico" id="artículoequivalente3_id" hidden>


                          <div class="row">

                            <div class="form-group col-md-10">
                                <label for="artículoequivalente4">Articulo Equivalente 5 </label>
                                <input class="form-control input-texto-alfanumerico" id="artículoequivalente4" placeholder="Nombre Articulo" > 
                              </div>
                                
                                <div id="div4" class="form-group col-md-2" style="display: none;">
                                  <button class="btn btn-danger btn-sm" style="margin-top:50% ;" type="button" onclick="eliminarEquivalente('#artículoequivalente4')">
                                    <i class="fas fa-trash" aria-hidden="true"></i>
                                  </button>
                                </div>
                          </div>
                                <input class="form-control input-texto-alfanumerico" id="artículoequivalente4_id" hidden>

            <div class="col-12 float-right">
                <button type="submit" class="btn btn-primary">Actualizar</button>
                <button type="button" class="btn btn-secondary float-right" data-dismiss="modal">Cerrar</button>
            </div> 

        </form>

    </div>

</div>
</div>


<!--  -->
        </div>
        <div class="modal-footer">
        </div>
      </div>
    </div>

<script>


$("#formEquivalente").submit(function(e) {
e.preventDefault();   

if($('#artículoequivalente0_id').val() != ''){
  enviarArticuloE($('#artículoequivalente0_id').val());
}

if($('#artículoequivalente1_id').val() != ''){
  enviarArticuloE($('#artículoequivalente1_id').val());
}

if($('#artículoequivalente2_id').val() != ''){
  enviarArticuloE($('#artículoequivalente2_id').val());
}

if($('#artículoequivalente3_id').val() != ''){
  enviarArticuloE($('#artículoequivalente3_id').val());
}

if($('#artículoequivalente4_id').val() != ''){
  enviarArticuloE($('#artículoequivalente4_id').val());
}


$('#ModalLong4').modal('hide');
$('ModalLong4').removeClass('show');
$('.modal-backdrop').remove();

});


function enviarArticuloE(id){

  const form = document.getElementById('formEquivalente');
  const formData = new FormData(form);

  formData.append('_method', 'PUT');

  $.ajax({
    method: "POST",
    url: url_back + "articulos/"+localStorage.editar+'/articuloequivalentes/'+ id,
    headers: { 
        Authorization: 'Bearer ' + localStorage.access_token
    },
    dataType: "json",
    data: formData,
    contentType: false,//formData
    processData: false,//formData
    success: function(respuesta) {


            var mensaje = ' Articulo Equivalente actualizado de forma correcta.: ';
            sweetMessage('success', mensaje); 
            
            // $('#main_content').load(url_front + 'articulos/edit.html');
    },
    error: function(respuesta) {

        if(respuesta.responseJSON.error){
            $.each(respuesta.responseJSON.error.message, function (key, item) {
                var mensaje = item[0];
                sweetMessage('error', mensaje);
            });

        }else{
            var mensaje = 'Se presentó un error. Por favor, inténtelo mas tarde.';
            sweetMessage('error', mensaje);
        }
    }
});
}


function obtenerArticuloequivalentes(id){

$.ajax({
    method: "GET",
    url: url_back + "articulos/"+id+'/articuloequivalentes',
    headers: { 
                  Authorization: 'Bearer ' + localStorage.access_token
              },
    dataType: "json",
    success: function(respuesta) {
      

        console.log(respuesta.data);

      if(respuesta.data.length == 5){ 
         llenarArticuloequivalentes(respuesta.data);
      }else if(respuesta.data.length == 4){
          reiniciar(4);
          llenarArticuloequivalentes(respuesta.data);
      }else if(respuesta.data.length == 3){
          reiniciar(3);
          reiniciar(4);
          llenarArticuloequivalentes(respuesta.data);
      }else if(respuesta.data.length == 2){
          reiniciar(2);
          reiniciar(3);
          reiniciar(4);
          llenarArticuloequivalentes(respuesta.data);
      }else if(respuesta.data.length == 1){
          reiniciar(1);
          reiniciar(2);
          reiniciar(3);
          reiniciar(4);
          llenarArticuloequivalentes(respuesta.data);
      }else{
          reiniciar(0);
          reiniciar(1);
          reiniciar(2);
          reiniciar(3);
          reiniciar(4);
      }

    },
    error: function() {
        var mensaje = 'Se presentó un error. Por favor, inténtelo mas tarde.';
        sweetMessage('error', mensaje);
    }
  })  
}


function reiniciar(id){

    $('#artículoequivalente'+id+'_id').val('');
    $('#artículoequivalente'+id).val('');
    $('#div'+id).hide();
    $('#artículoequivalente'+id).prop('readonly',false);
}


    //******************************************************************************************************************************************************************************
    
    var llenarArticuloequivalentes = function(arre){
      
      arre.forEach(function callback(element, i) {

        $('#artículoequivalente'+ i +'_id').val(element.id);
        $('#artículoequivalente'+ i).val(element.codigo+'-'+element.nombre);
        $('#div'+i).show();
        $('#artículoequivalente'+ i).prop('readonly',true);

      });


    }
    
    //******************************************************************************************************************************************************************************
    
    $( "#artículoequivalente0" ).autocomplete({
       source: function( request, response ) {

           var url = 'equivalentes/'+localStorage.editar+'?search='+$('#artículoequivalente0').val(); 

          $.ajax({
            method: "GET",
            url: url_back + url,
            headers: { 
               Authorization: 'Bearer ' + localStorage.access_token
           },
            dataType: "json",
            success: function(respuesta) {
               response(respuesta);
            }
          });
       },
       autoFocus: true,
       minLength: 2,
       appendTo: "#ModalLong4",
       select: function (event, ui) {
         // Set selection
         $('#artículoequivalente0').val(ui.item.label); // display the selected text
         $('#artículoequivalente0_id').val(ui.item.value); // save selected id to input
         return false;
       }
    });


    $( "#artículoequivalente1" ).autocomplete({
       source: function( request, response ) {

           var url = 'equivalentes/'+localStorage.editar+'?search='+$('#artículoequivalente1').val(); 

          $.ajax({
            method: "GET",
            url: url_back + url,
            headers: { 
               Authorization: 'Bearer ' + localStorage.access_token
           },
            dataType: "json",
            success: function(respuesta) {
               response(respuesta);
            }
          });
       },
       autoFocus: true,
       minLength: 2,
       appendTo: "#ModalLong4",
       select: function (event, ui) {
         // Set selection
         $('#artículoequivalente1').val(ui.item.label); // display the selected text
         $('#artículoequivalente1_id').val(ui.item.value); // save selected id to input
         return false;
       }
    });


    $( "#artículoequivalente2" ).autocomplete({
       source: function( request, response ) {

           var url = 'equivalentes/'+localStorage.editar+'?search='+$('#artículoequivalente2').val(); 

          $.ajax({
            method: "GET",
            url: url_back + url,
            headers: { 
               Authorization: 'Bearer ' + localStorage.access_token
           },
            dataType: "json",
            success: function(respuesta) {
               response(respuesta);
            }
          });
       },
       autoFocus: true,
       minLength: 2,
       appendTo: "#ModalLong4",
       select: function (event, ui) {
         // Set selection
         $('#artículoequivalente2').val(ui.item.label); // display the selected text
         $('#artículoequivalente2_id').val(ui.item.value); // save selected id to input
         return false;
       }
    });


    $( "#artículoequivalente3" ).autocomplete({
       source: function( request, response ) {

           var url = 'equivalentes/'+localStorage.editar+'?search='+$('#artículoequivalente3').val(); 

          $.ajax({
            method: "GET",
            url: url_back + url,
            headers: { 
               Authorization: 'Bearer ' + localStorage.access_token
           },
            dataType: "json",
            success: function(respuesta) {
               response(respuesta);
            }
          });
       },
       autoFocus: true,
       minLength: 2,
       appendTo: "#ModalLong4",
       select: function (event, ui) {
         // Set selection
         $('#artículoequivalente3').val(ui.item.label); // display the selected text
         $('#artículoequivalente3_id').val(ui.item.value); // save selected id to input
         return false;
       }
    });
 
 
    $( "#artículoequivalente4" ).autocomplete({
       source: function( request, response ) {

           var url = 'equivalentes/'+localStorage.editar+'?search='+$('#artículoequivalente4').val(); 

          $.ajax({
            method: "GET",
            url: url_back + url,
            headers: { 
               Authorization: 'Bearer ' + localStorage.access_token
           },
            dataType: "json",
            success: function(respuesta) {
               response(respuesta);
            }
          });
       },
       autoFocus: true,
       minLength: 2,
       appendTo: "#ModalLong4",
       select: function (event, ui) {
         // Set selection
         $('#artículoequivalente4').val(ui.item.label); // display the selected text
         $('#artículoequivalente4_id').val(ui.item.value); // save selected id to input
         return false;
       }
    });


    var eliminarEquivalente = function(element){

      artículoequivalente_id = $(element+'_id').val();


        $.ajax({
        method: "DELETE",
        url: url_back + 'articulos/'+ localStorage.editar + '/articuloequivalentes/'+ artículoequivalente_id,
        headers: { 
            Authorization: 'Bearer ' + localStorage.access_token
        },
        dataType: "json",
        success: function(respuesta) {

            var mensaje = 'El Articulo Equivalente se elimino correctamente.';
            sweetMessage('success', mensaje);
            // $(element).val('');

            obtenerArticuloequivalentes(localStorage.editar);


        },
        error: function() {
            var mensaje = 'Se presentó un error. Por favor, inténtelo mas tarde.';
            sweetMessage('error', mensaje);
        }
      })  
    }


$( document ).ready(function() {
    $('.preloader').hide("slow");
      validarLogin();
      obtenerArticuloequivalentes(localStorage.editar);


});

</script>

<!-- validaciones -->
<script src="../../build/js/validaciones.js"></script>