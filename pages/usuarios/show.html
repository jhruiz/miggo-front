<!-- Modal -->
<div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">
            <i class="nav-icon fas fa-user"></i>
            Ver usuario</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
<!--  -->


<div class="card">
  <div class="card-header">
      <div class="row">
          <div class="col-12">
              <h4>
                  <!-- <img id="imagen" src="../usuarios/user-04.jpg" /> -->
                  <img id="imagen" src="" />
              </h4>
          </div>
      </div>
  </div>

  <div class="card-body">
        
        
    <form method="PUT" action="" enctype="multipart/form-data">

        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text"><i class="fas fa-signature"></i></span>
            </div>
            <input type="text" id="nombres" class="form-control" placeholder="Nombres" disabled> 
        </div>

        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text"><i class="fas fa-signature"></i></span>
            </div>
            <input type="text" id="apellidos" class="form-control" placeholder="Apellidos" disabled> 
        </div>

        <div class="form-group">
            <label for="exampleSelectBorder">Tipo Identificacion</label>
            <select class="custom-select form-control-border" id="select-identificacion">
              <!-- <option>Value 1</option> -->

            </select>
          </div>

        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text"><i class="fas fa-id-card"></i></span>
            </div>
            <input type="text" id="identificacion" class="form-control" placeholder="Identificación" disabled> 
        </div>   

        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text"><i class="fas fa-envelope"></i></span>
            </div>
            <input type="text" id="email" class="form-control" placeholder="Email" disabled> 
        </div>   

        <div class="form-group">
          <label for="exampleSelectBorder">Perfil</label>
          <select class="custom-select form-control-border" id="select-perfiles">
            <!-- <option>Value 1</option> -->

          </select>
        </div>

        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text"><i class="fas fa-id-card"></i></span>
            </div>
            <textarea id="direccion" class="form-control" rows="3" placeholder="Dirección ..." disabled></textarea>
        </div> 

        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text"><i class="fas fa-id-card"></i></span>
            </div>
            <input type="text" id="rut" class="form-control" placeholder="RUT" disabled>
        </div> 

        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text"><i class="fas fa-id-card"></i></span>
            </div>
            <input type="text" id="celular" class="form-control" placeholder="Celular" disabled>
        </div> 

        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text"><i class="fas fa-id-card"></i></span>
            </div>
            <input type="text" id="telefono" class="form-control" placeholder="Teléfono" disabled>
        </div>

        <div class="form-group">
            <label>Cumpleaños:</label>
              <div class="input-group date">
                  <input type="text" id="cumpleanios" class="form-control datetimepicker-input" disabled>
                      <div class="input-group-text"><i class="fa fa-calendar"></i></div>
              </div>
          </div>

          <div class="form-group">
            <label for="exampleSelectRounded0">Ciudad</label>
            <select class="custom-select rounded-0" id="select-ciudad">
              <!-- <option>Value 1</option> -->

            </select>
          </div>
        
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text"><i class="fas fa-id-card"></i></span>
            </div>
            <input type="text" id="username" class="form-control" placeholder="Username" disabled>
        </div> 

          <div class="form-group">
            <label for="customFile">Custom File</label>

            <div class="custom-file">
              <input type="file" id="imagen" class="custom-file-input" id="customFile">
              <label class="custom-file-label" for="customFile">Elija la Foto</label>
            </div>
          </div>

        <div class="col-12 float-right">
            <button type="button" id="actualizar" class="btn btn-secondary float-right" data-dismiss="modal">Cerrar</button>
        </div> 

    </form>

</div>

</div>


</div>





<!--  -->
        </div>
        <div class="modal-footer">
          <!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button> -->
          <!-- <button type="button" class="btn btn-primary">Enviar</button> -->
        </div>
      </div>
    </div>
  </div>


  <script>


//***************************************************trae valores de persona y usuario si ya exiten (perfil,ciudad,tipodocumento)*******************
var obtenerCiudad = function(id){
    url_ciu= 'ciudades/' + id;
    $.ajax({
    method: "GET",
    url: url_back + url_ciu,
    headers: { 
        Authorization: 'Bearer ' + localStorage.access_token
    },
    dataType: "json",
    success: function(respuesta) {
            var htmlCiudades = '';
            htmlCiudades += '<option value="'+ respuesta.data.id+'">';
            htmlCiudades += respuesta.data.descripcion;
            htmlCiudades += '</option>';
            $('#select-ciudad').html(htmlCiudades);
    },
    error: function() {
        var mensaje = 'Se presentó un error. Por favor, inténtelo mas tarde.';
        sweetMessage('error', mensaje);
    }
  })  
}

var obtenerPerfil = function(id){
    url_perf= 'perfiles/'+id;
    $.ajax({
    method: "GET",
    url: url_back + url_perf,
    headers: { 
        Authorization: 'Bearer ' + localStorage.access_token
    },
    dataType: "json",
    success: function(respuesta) {
            var htmlPerfil = '';
            htmlPerfil += '<option value="'+ respuesta.data.id+'">';
            htmlPerfil += respuesta.data.descripcion;
            htmlPerfil += '</option>';
            $('#select-perfiles').html(htmlPerfil);
    },
    error: function() {
        var mensaje = 'Se presentó un error. Por favor, inténtelo mas tarde.';
        sweetMessage('error', mensaje);
    }
  })  
}

var obtenerTipoidentificacione = function(id){
    url_tipo= 'tipoidentificaciones/'+id;
    $.ajax({
    method: "GET",
    url: url_back + url_tipo,
    headers: { 
        Authorization: 'Bearer ' + localStorage.access_token
    },
    dataType: "json",
    success: function(respuesta) {
            var htmlTipo = '';
            htmlTipo += '<option value="'+ respuesta.data.id+'">';
            htmlTipo += respuesta.data.descripcion;
            htmlTipo += '</option>';
            $('#select-identificacion').html(htmlTipo);
    },
    error: function() {
        var mensaje = 'Se presentó un error. Por favor, inténtelo mas tarde.';
        sweetMessage('error', mensaje);
    }
  })  
}

//*************************************************************************************************************************

function obtenerUsuario(id){

var url = 'users/'+ id;

$.ajax({
    method: "GET",
    url: url_back + url,
    headers: { 
                  Authorization: 'Bearer ' + localStorage.access_token
              },
    dataType: "json",
    success: function(respuesta) {

        $('#nombres').val(respuesta.data.persona.nombres);
        $('#apellidos').val(respuesta.data.persona.apellidos);
        $('#identificacion').val(respuesta.data.persona.identificacion);
        $('#email').val(respuesta.data.email);
        $('#direccion').val(respuesta.data.persona.direccion);
        $('#rut').val(respuesta.data.persona.rut);
        $('#celular').val(respuesta.data.persona.celular);
        $('#telefono').val(respuesta.data.persona.telefono);
        $('#cumpleanios').val(respuesta.data.persona.cumpleanios);
        $('#username').val(respuesta.data.username);
        // $('#imagen').val(respuesta.data.persona.imagen); // previsualizar

          if(respuesta.data.imagen){
            // $("#imagen").attr("src","../usuarios/"+ respuesta.data.imagen);
            // $("#imagen").attr("src","../usuarios/"+ 'user-04.jpg');

            // $("#imagen").attr('src','http://localhost:85/miggo-accountant-back/public/images/img_api/users/'+ respuesta.data.imagen);
            $("#imagen").attr('src', url_img + 'users/'+ respuesta.data.imagen);




          }else{
            $("#imagen").attr("src","../usuarios/"+ 'defecto.jpg');
          }

        if(respuesta.data.persona.ciudade_id){
            obtenerCiudad(respuesta.data.persona.ciudade_id);
        }
        if(respuesta.data.perfile_id){
            obtenerPerfil(respuesta.data.perfile_id);
        }

        if(respuesta.data.persona.tipoidentificacione_id){
            obtenerTipoidentificacione(respuesta.data.persona.tipoidentificacione_id);
        }

    },
    error: function() {
        var mensaje = 'Se presentó un error. Por favor, inténtelo mas tarde.';
        sweetMessage('error', mensaje);
    }
  })  
}



$( document ).ready(function() {
    $('.preloader').hide("slow");

    obtenerUsuario(localStorage.ver);




});
  </script>